# 读书笔记3

## 3. 中断和异常处理

### 3.1. 中断和异常处理概述

#### 定义
- **中断**：是处理器响应硬件事件的机制，如I/O设备请求服务。
- **异常**：是处理器对正在执行的指令或程序状态做出的响应，如发生算术错误（除以零）。
#### 处理器响应
- 处理器通过中断和异常向量表来确定相应的处理程序，并执行相应的处理代码。
#### 中断向量表
- **实模式**：中断向量表固定在内存地址0开始的区域，共256个中断向量。
- **保护模式**：中断向量表（IDT）更为灵活，可以位于内存的任何位置，由中断描述符表寄存器（IDTR）指定。

### 3.2. 有关中断和异常的了解性内容

#### 中断和异常向量
- 每个中断或异常向量都有一个唯一的处理程序与之关联。
#### 中断源与异常源
- **中断源**：通常是硬件设备，如定时器、键盘等。
- **异常源**：通常是软件执行过程中的问题，如非法操作码、页面错误等。
#### 异常分类
- **故障**：通常是可恢复的错误，如页面故障。
- **陷阱**：用于处理正常事件，如系统调用。
- **中止**：表示不可恢复的错误，如硬件错误。
#### 程序或任务的重新执行
- 可以通过设置EFLAGS寄存器中的中断标志（IF）来开启或禁止中断。
#### 异常和中断的优先级
- 决定了它们被处理的顺序，通常由硬件设计决定。

### 3.3. 中断描述符表（IDT）

#### 构成
- 由中断描述符组成，每个描述符对应一个中断或异常向量。
#### 获取中断处理程序地址
- 通过IDT中的描述符来获取中断服务例程（ISR）的地址。
#### 设置中断描述符表寄存器
- 使用LGDT指令加载全局描述符表寄存器（GDTR）。
- 使用LIDT指令加载中断描述符表寄存器（IDTR）。

### 3.4. IDT 描述符

#### 描述符格式
- **中断门**：定义了中断处理机制和权限，执行时会清除IF标志。
- **陷阱门**：与中断门类似，但执行时不会清除IF标志。
- **任务门**：用于任务切换。
#### 描述符字段
- **偏移量**：指向中断服务例程的代码。
- **段选择子**：指向代码段的描述符。
- **类型**：指定描述符的类型（中断门、陷阱门等）。
- **DPL**：描述符特权级别，用于权限检查。
- **P**：表示描述符是否有效。

### 3.5. 中断与异常处理

#### 中断过程调用流程
1. 保存处理器状态（如EFLAGS、CS、EIP等）。
2. 执行中断服务例程（ISR）。
3. 恢复处理器状态。
#### 优先级判断
- 处理器的当前特权级别和中断的优先级决定了中断处理过程是否可以打断当前任务。
#### 不同优先级的处理方式
- 高优先级的中断可以打断低优先级的中断处理。
#### 堆栈切换时的处理器操作
- 保存当前堆栈状态。
- 切换到预先定义的堆栈。
#### 无堆栈切换时的处理器操作
- 在当前堆栈上执行ISR。
#### 中断处理后的返回操作
- 使用IRET指令从ISR返回，恢复到被中断的代码。
- 从堆栈中恢复状态（如EFLAGS、CS、EIP等）。
#### 异常和中断处理过程的保护
- 通过权限检查和错误处理来保护。
#### 标志使用方式
- EFLAGS寄存器中的标志会影响中断和异常的处理过程。
#### 中断门与陷阱门的区别
- 中断门在执行ISR前会自动清除IF标志，防止嵌套中断。
- 陷阱门则不会清除IF标志，允许嵌套中断。

途中搜索的相关网站：
https://blog.csdn.net/klkfl/category_7941312.html